<!DOCTYPE html>
<html>
<head>
<title>Testing the Minesweeper Canvas</title>
<script src='maps.txt'></script> <!-- This is a bit cheaty; it's the maps file that contains a string. -->
</head>
<body>
<p>Canvas below:</p>
<canvas id="minesweeper" width="650" height="650">Your browser doesn't support the &lt;canvas&gt; element</canvas> <!-- style="border:1px solid #000000;" -->
<!-- JavaScript below -->
<script>
window.onload = function() {
	// Values which will be replaced by a form or something and are here for testing
	var cols = 3;
	var rows = 3;
	var score = 10;
	var mapID = "JP";
	var lat = "0";
	var lon = "0";
	var justSubRegion = true;
	// Getting the correct map from maps.js
	var map = "o";
	console.log(txt);
	var textByLine = txt.split("\n"); //txt is the contents of maps.js... technically.
	for (let i = 0; i < textByLine.length; i++) {
		if (textByLine[i].split(";").length > 2) {
			let info = textByLine[i].split(";").slice(0,-1)
			if (mapID.split(":").length === 1) { // is top level region
				if (mapID === info[0] || mapID === info[1]){ // is valid
					cols = info[2]-info[3]+3;
					rows = info[5]-info[4]+3;
					map = "e";
				}
			} else if (info.length === 7) { // is subregion
				if (mapID.split(":")[1] === info[2].split(":")[0] && mapID.split(":")[0] === info[2].split(":")[1]) {
					if (justSubRegion) {
						cols = info[3]-info[4]+3;
						rows = info[6]-info[5]+3;
						map = "e";
					}
				}
			}
		}
	}
	if (map === "o"){
		alert("The region code is incorrect.");
	}
	// Sorting out the canvas
	var canvas = document.getElementById("minesweeper");
	canvas.width = 24+16*rows;
	canvas.height = 66+16*cols;
	var ctx = canvas.getContext("2d");
	ctx.fillStyle = "#C0C0C0"
	ctx.fillRect(0, 0, canvas.width, canvas.height);
	function draw(src, x, y) {
		var sprite = new Image();
		sprite.src = "sprites/"+src+".png";
		sprite.onload = () => ctx.drawImage(sprite, x, y);
	}
	
	// Drawing stuff to the canvas
	draw("tl",0,0);
	draw("tr",13+16*rows,0);
	draw("bl",0,55+16*cols);
	draw("br",13+16*rows,55+16*cols);
	for (let i = 0; i < rows; i++) {
		draw("t", 13+16*i, 0);
		draw("m", 13+16*i, 44);
		draw("b", 13+16*i, 55+16*cols);
	}
	for (let i = 0; i < cols; i++) {
		draw("l", 0, 55+16*i);
		draw("r", 13+16*rows, 55+16*i);
	}
	for (let col = 0; col < cols; col++) {
		for (let row = 0; row < rows; row++) {
			draw("unpressed",13+16*row,55+16*col);
		}
	}
	draw("smile",((24+16*rows)/2)-13,15);
};
</script>
</body>
</html>